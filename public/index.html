<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wake/Sleep LAN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --bg1: #0f172a;
      --bg2: #1f2937;
      --accent: #22c55e;
      --accent2: #f97316;
    }
    body {
      min-height: 100vh;
      background: radial-gradient(1200px 600px at 10% 10%, #111827 0%, var(--bg1) 40%, var(--bg2) 100%);
      color: #e5e7eb;
    }
    .panel {
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
    }
    .status-pill {
      font-size: 0.9rem;
    }
    .switch-btn {
      font-size: 1.05rem;
    }
    .icon-big {
      font-size: 2.6rem;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-7">
        <div class="panel rounded-4 p-4">
          <div class="d-flex align-items-center justify-content-between mb-4">
            <div>
              <h1 class="h3 mb-1">Wake / Sleep LAN</h1>
              <div class="text-secondary">Controle simples para acordar e desligar a máquina</div>
            </div>
            <i class="bi bi-pc-display icon-big"></i>
          </div>

          <div class="d-flex align-items-center gap-2 mb-4">
            <span class="badge rounded-pill text-bg-secondary status-pill" id="status">Pronto</span>
            <span class="text-secondary" id="statusDetail">Aguardando ação</span>
          </div>

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <button class="btn btn-success w-100 switch-btn" id="btnWake">
                <i class="bi bi-toggle2-on me-2"></i> Acordar
              </button>
            </div>
            <div class="col-12 col-md-6">
              <button class="btn btn-warning w-100 switch-btn" id="btnSleep">
                <i class="bi bi-toggle2-off me-2"></i> Desligar
              </button>
            </div>
          </div>

          <hr class="my-4 border-secondary" />

          <div class="text-secondary small">
            Dica: mantenha essa página aberta na rede interna. As ações são registradas no log do servidor.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const statusDetailEl = document.getElementById("statusDetail");
    const btnWake = document.getElementById("btnWake");
    const btnSleep = document.getElementById("btnSleep");

    function setStatus(state, detail, kind) {
      statusEl.textContent = state;
      statusDetailEl.textContent = detail;
      statusEl.className = `badge rounded-pill status-pill text-bg-${kind}`;
    }

    async function refreshStatus() {
      try {
        const res = await fetch("/api/status");
        const json = await res.json();
        if (!res.ok || !json.ok) {
          throw new Error("status_error");
        }
        if (json.online) {
          setStatus("Online", "Servidor acordado", "success");
        } else {
          setStatus("Offline", "Servidor desligado", "secondary");
        }
      } catch {
        setStatus("Erro", "Falha ao checar status", "danger");
      }
    }

    async function callApi(path) {
      setStatus("Enviando", "Aguarde...", "info");
      try {
        const res = await fetch(path, { method: "POST" });
        const json = await res.json();
        if (!res.ok || !json.ok) {
          throw new Error(json.error || "Erro desconhecido");
        }
        setStatus("OK", "Comando enviado", "success");
      } catch (err) {
        setStatus("Erro", err.message, "danger");
      }
    }

    btnWake.addEventListener("click", () => callApi("/api/wake"));
    btnSleep.addEventListener("click", () => callApi("/api/sleep"));

    refreshStatus();
    setInterval(refreshStatus, 5000);
  </script>
</body>
</html>
